{% assign buttons = site.data.frens %}

{% comment %} buttons {% endcomment %}
<div class="buttons">
  {% for button in buttons %}
    {% if button.src %}
      <a href="{{ button.href }}" target="_blank">

        {% comment %} fallback {% endcomment %}
        {% if button.fallback %}
          {% assign fallback = button.fallback %}
        {% else %}
          {% assign fallback = "/assets/images/buttons/Huh%3F Why didnt I start the fire%3F Well, they never came home. Are you mad%3F I got the kerosene ready and everything. Just like you said to. I know I didnt dump it over my head. But I didnt want to get wet. Besides, if they werent coming back.avif" %}
        {% endif %}

        {% comment %} iframe buttons {% endcomment %}
        {% if button.iframe %}
          <iframe
            src="{{ button.src }}"
            loading="lazy"
            title="{{ button.title }}"
            data-description="{{ button.description }}"
            sandbox="allow-scripts allow-popups"></iframe>

        {% comment %} gif buttons (static versions for accessibility) {% endcomment %}
        {% elsif button.src-static %}
          <picture>
            <source
              srcset="{{ button.src-static }}"
              type="image/webp"
              media="(prefers-reduced-motion: reduce)">
            <img
              src="{{ button.src }}"
              alt="{{ button.alt | default: button.title }}"
              title="{{ button.title }}"
              data-description="{{ button.description }}"
              loading="lazy"
              onerror="this.onerror=null; this.src=`{{ fallback }}`;">
          </picture>

        {% comment %} video buttons (fuck gifs lol) {% endcomment %}
        {% elsif button.video %}
          <video
            src="{{ button.src }}"
            poster="{{ button.poster | default: fallback }}"
            autoplay
            muted
            loop
            playsinline
            preload="auto"
            title="{{ button.title }}"
            data-description="{{ button.description }}"
            loading="lazy"
            onerror="this.onerror=null; this.poster=`{{ fallback }}`;">
          </video>

        {% comment %} regular buttons {% endcomment %}
        {% else %}
          <img
            src="{{ button.src }}"
            alt="{{ button.alt | default: button.title }}"
            title="{{ button.title }}"
            data-description="{{ button.description }}"
            loading="lazy"
            onerror="this.onerror=null; this.src=`{{ fallback }}`;">
        {% endif %}
      </a>
    {% endif %}
  {% endfor %}

</div>

{% comment %} button description {% endcomment %}
<p id="button-desc">hover a button for description :)&nbsp; (bro thinks she's notnite)</p>

<script>
  function getRandomInt(max) {
    return Math.floor(Math.random() * max);
  }

  document.querySelectorAll('.buttons a img, .buttons iframe').forEach(b => {
    b.addEventListener('mouseover', (e)=>{
      document.querySelector('#button-desc').innerText = `${b.title} - ${b.dataset.description || 'no description'}`;
    });

    b.addEventListener('mouseout', (e)=>{
      document.querySelector('#button-desc').innerText = 'hover a button for a description :)';
    });
  });
</script>

{% comment %} friends with no buttons are displayed in a list {% endcomment %}
<ul>
  {% for button in buttons %}
    {% unless button.src %}
      <li>
        <a href="{{ button.href }}" target="_blank">{{ button.title }}</a>
      </li>
    {% endunless %}
  {% endfor %}
</ul>
